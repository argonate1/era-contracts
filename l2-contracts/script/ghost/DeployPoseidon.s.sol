// SPDX-License-Identifier: MIT
pragma solidity 0.8.28;

import "forge-std/Script.sol";

/// @title DeployPoseidon
/// @notice Deploys the PoseidonT3 library directly using bytecode
contract DeployPoseidon is Script {
    function run() external {
        uint256 deployerPrivateKey = vm.envOr(
            "DEPLOYER_PRIVATE_KEY",
            uint256(0x3eb15da85647edd9a1159a4a13b9e7c56877c4eb33f614546d4db06a51868b1c) // Default dev key
        );

        vm.startBroadcast(deployerPrivateKey);

        // Deploy PoseidonT3 by sending bytecode directly
        // The bytecode is from poseidon-solidity npm package
        bytes memory bytecode = hex"615bb6610026600b82828239805160001a60731461001957fe5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600436106100355760003560e01c8063561558fe1461003a575b600080fd5b6100856004803603604081101561005057600080fd5b604080518082018252918301929181830191839060029083908390808284376000920191909152509194506100979350505050565b60408051918252519081900360200190f35b60006100a282610112565b602080820151604051939450600093849384938493635f4d53c360e01b8652600486019190915260248501919091529051634e597a2b60e01b91606481019182528751608482015287519093737b6fd60f5a8f45cd9f90a4d2e8af1a0fe89ef6209163635f4d53c391869160a4909101908190838660005b8381101561013257818101518382015260200161011a565b50505050905001935050505060206040518083038186803b15801561015657600080fd5b505af415801561016a573d6000803e3d6000fd5b505050506040513d602081101561018057600080fd5b505160408051634e597a2b60e01b8152600481019290925260248201839052519091507f30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000001908290";

        address poseidonAddress;
        assembly {
            poseidonAddress := create(0, add(bytecode, 0x20), mload(bytecode))
        }

        console.log("PoseidonT3 deployed at:", poseidonAddress);

        vm.stopBroadcast();
    }
}
